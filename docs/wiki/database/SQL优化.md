做MySQL优化，我们要善用EXPLAIN查看SQL执行计划。 写SQL记住优化原则，效率至少提高3倍

**1.EXPLAIN执行计划,索引**

type列，连接类型。一个好的SQL语句至少要达到range级别。杜绝出现all级别。

key列，使用到的索引名。如果没有选择索引，值是NULL。可以采取强制索引方式。

key_len列，索引长度。

rows列，扫描行数。该值是个预估值。

extra列，详细说明。注意，常见的不太友好的值，如下：Using filesort，Using temporary。

**2.SQL语句**

**SQL语句中IN包含的值不应过多** 

MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好 序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用between就不要用in了；再或者使用连接来替换。

**SELECT语句务必指明字段名称** 

SELECT*增加很多不必要的消耗（CPU、IO、内存、网络带宽）；增加了使用覆盖索引的可能性； 当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。 如果排序字段没有用到索引，就尽量少排序 尽量用union all代替union union和union all的差异主要是前者需要将结果集合并后再进行唯一性过滤操作，这就会涉及到排 序，增加大量的CPU运算，加大资源消耗及延迟。当然，union all的前提条件是两个结果集没有重 复数据。 分段查询 在一些用户选择页面中，可能一些用户选择的时间范围过大，造成查询缓慢。主要的原因是扫描行 数过多。这个时候可以通过程序，分段进行查询，循环遍历，将结果合并处理进行展示。

**不建议使用%前缀模糊查询** 

例如LIKE“%name”或者LIKE“%name%”，这种查询会导致索引失效而进行全表扫描。但是可以使用 LIKE “name%”。

**对于联合索引来说，要遵守最左前缀法则** 

举列来说索引含有字段id、name、school，可以直接用id字段，也可以id、name这样的顺序，但 是name;school都无法使用这个索引。所以在创建联合索引的时候一定要注意索引字段顺序，常用 的查询字段放在最前面。

**必要时可以使用force index来强制查询走某个索引** 

有的时候MySQL优化器采取它认为合适的索引来检索SQL语句，但是可能它所采用的索引并不是我 们想要的。这时就可以采用forceindex来强制优化器使用我们制定的索引。 注意范围查询语句 对于联合索引来说，如果存在范围查询，比如between、>、<等条件时，会造成后面的索引字段失 效。

**关于JOIN优化，小表驱动大表** 

LEFT JOIN A表为驱动表，INNER JOIN MySQL会自动找出那个数据少的表作用驱动表，RIGHT JOIN B表为驱动表。

**3.缓存数据**：

建立一些redis缓存表，来差比较大的数据



**4.架构上** 

分库分表：数据量太大，达到单库单表的瓶颈；字段比较长、存储二进制数据的可以分表出来

读写分离：适合读多写少的情况，主从复制->读写分离。写到主数据库，保持主数据同步到从数据库，在从数据库读出来

